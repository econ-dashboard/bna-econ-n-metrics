cols = c("qrtly_estabs", "avg_wkly_wage")
)
data_raw_bls_data
data_raw_bls_data %>%
pivot_longer(
cols = c("qtrly_estabs", "avg_wkly_wage")
)
data_raw_bls_data
2014:2020
yq("2014-01")
?ymd
?yq
yq("2014-01-01")
yq("2014-01-01")
ymd("2014-01-01")
# For each package below, we check to see if the relevant library is already
# installed. If so, we load it, if not, we install it, then load it.
our_packages <-
c(
"tictoc",
"whisker",
"jsonlite",
"openxlsx",
"lubridate",
"tidyverse"
)
yq("2014-01-01")
ymd("2014-01-01")
source("../../lib/load_r_libraries.R")
ymd('2012-04-07')
yq("2014-01-01")
yq('2014-01-01')
yq('2014-01')
quarter("2014-01")
?quarter
yearqtr("2014-01")
yq('2014:Q1')
quarter(yq('2014:Q1'))
quarter(yq('2014:Q1'), with_year = T)
quarter('2014-1', with_year = T)
quarter(yq('2014-01'), with_year = T)
yq("2014-01")
seq(yq("2014-01"), yq("2020-03"), by = "1 quarter")
quarter(seq(yq("2014-01"), yq("2020-03"), by = "1 quarter"))
quarter(seq(yq("2014-01"), yq("2020-03"), by = "1 quarter"), with_year = T)
?quarter
for (period in available_periods) {
print(period)
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
print(period)
}
print("year", "-", "qtr")
for (period in available_periods) {
year <- y(period)
qtr <- quarter(period)
print("year", "-", "qtr")
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
year <- year(period)
qtr <- quarter(period)
print("year", "-", "qtr")
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
year <- year(period, "%y.%q")
qtr <- quarter(period)
print("year", "-", "qtr")
}
#year <- year(period,)
qtr <- quarter(period)
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
#year <- year(period,)
qtr <- quarter(period)
print("year", "-", "qtr")
}
print("year", "-", "qtr")
print("year", "-", "qtr")
print("year")
for (period in available_periods) {
#year <- year(period,)
qtr <- quarter(period)
print("year")
}
print(qtr)
for (period in available_periods) {
#year <- year(period,)
qtr <- quarter(period)
print(qtr)
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
ymd(period)
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
ymd(quarter(period))
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
ymd(quarter(period))
}
quarter(period)
for (period in available_periods) {
quarter(period)
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
period
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
)
for (period in available_periods) {
print(ymd(period))
}
available_periods
for (period in available_periods) {
print(yq(period, "%Y.%q"))
}
for (period in available_periods) {
print(format(period, "%Y.%q"))
}
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
?str_extract
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 4L, end = 6L)
print(yr, "-", qtr)
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 4L, end = 6L)
paste0(yr, "-", qtr)
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 4L, end = 6L)
print(paste0(yr, "-", qtr))
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 6L, end = 6L)
print(paste0(yr, "-", qtr))
}
data_lau <-
tibble(
fips_code = NA_character_,
period = NA_character_,
qtrly_estabs = NA_real_,
avg_wkly_wage = NA_real_
)
data_bls <-
tibble(
fips_code = NA_character_,
period = NA_character_,
qtrly_estabs = NA_real_,
avg_wkly_wage = NA_real_
)
knitr::opts_chunk$set(echo = TRUE)
source("../../lib/load_r_libraries.R")
bls_data_url_in <- "http://www.bls.gov/cew/data/api/2020/1/industry/10.csv"
fips_mappings_path_in <- "../../data/processed/reference_data/county_fips_mappings.csv"
data_bls <-
tibble(
fips_code = NA_character_,
period = NA_character_,
qtrly_estabs = NA_real_,
avg_wkly_wage = NA_real_
)
data_fips_mappings <-
fips_mappings_path_in %>%
read_csv()
data_raw_bls_data <-
bls_data_url_in %>%
read_csv() %>%
transmute(
fips_code = area_fips,
period = str_c(year, "-", qtr),
qtrly_estabs,
avg_wkly_wage
)
knitr::opts_chunk$set(echo = TRUE)
source("../../lib/load_r_libraries.R")
bls_data_url_in <- "http://www.bls.gov/cew/data/api/2020/1/industry/10.csv"
fips_mappings_path_in <- "../../data/processed/reference_data/county_fips_mappings.csv"
data_bls <-
tibble(
fips_code = NA_character_,
period = NA_character_,
qtrly_estabs = NA_real_,
avg_wkly_wage = NA_real_
)
data_fips_mappings <-
fips_mappings_path_in %>%
read_csv()
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 6L, end = 6L)
data_path <- paste0("http://www.bls.gov/cew/data/api/", yr, "/", qtr, "/industry/10.csv")
data_bls <-
read_csv() %>%
transmute(
fips_code = area_fips,
period = str_c(year, "-", qtr),
qtrly_estabs,
avg_wkly_wage
) %>%
rbind(data_bls)
print(paste0(yr, "-", qtr))
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2014-01")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 6L, end = 6L)
data_path <- paste0("http://www.bls.gov/cew/data/api/", yr, "/", qtr, "/industry/10.csv")
data_bls <-
data_path %>%
read_csv() %>%
transmute(
fips_code = area_fips,
period = str_c(year, "-", qtr),
qtrly_estabs,
avg_wkly_wage
) %>%
rbind(data_bls)
print(paste0(yr, "-", qtr))
}
# Loop from 2014-01 to 2020-3
period_start <- yq("2019-04")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 6L, end = 6L)
data_path <- paste0("http://www.bls.gov/cew/data/api/", yr, "/", qtr, "/industry/10.csv")
data_bls <-
data_path %>%
read_csv() %>%
transmute(
fips_code = area_fips,
period = str_c(year, "-", qtr),
qtrly_estabs,
avg_wkly_wage
) %>%
rbind(data_bls)
print(paste0(yr, "-", qtr))
}
data_bls
data_fips_mappings %>%
left_join(data_bls, by = fips_code)
data_fips_mappings %>%
left_join(data_bls, by = "fips_code")
data_fips_mappings %>%
left_join(data_bls, by = "fips_code") %>%
data_fips_mappings %>%
left_join(data_bls, by = "fips_code")
data_fips_mappings %>%
left_join(data_bls, by = "fips_code")
data_fips_mappings %>%
left_join(data_bls, by = "fips_code") %>%
select(
fips_code,
area,
period,
qtrly_estabs,
avg_wky_wage
)
data_fips_mappings %>%
left_join(data_bls, by = "fips_code") %>%
select(
fips_code,
area,
period,
qtrly_estabs,
avg_wkly_wage
)
data_fips_mappings %>%
left_join(data_bls, by = "fips_code") %>%
select(
fips_code,
area,
period,
qtrly_estabs,
avg_wkly_wage
)
for (fip in available_fips) {
data_bls %>%
filter(fips_code == fip) %>%
write_csv(str_c(bls_data_path_out, fip, "/bls_data_", fip, ".csv"))
}
source('~/stanford_coding/bna-econ-n-metrics/scripts/data_wrangling/pull_cty_fips_mappings.R', echo=TRUE)
for (fip in available_fips) {
data_bls %>%
filter(fips_code == fip) %>%
write_csv(str_c(bls_data_path_out, fip, "/bls_data_", fip, ".csv"))
}
bls_data_path_out <- "county-data/counties/"
data_bls <-
tibble(
fips_code = NA_character_,
period = NA_character_,
qtrly_estabs = NA_real_,
avg_wkly_wage = NA_real_
)
bls_data_path_out <- "../../county-data/counties/"
knitr::opts_chunk$set(echo = TRUE)
source("../../lib/load_r_libraries.R")
bls_data_url_in <- "http://www.bls.gov/cew/data/api/2020/1/industry/10.csv"
fips_mappings_path_in <- "../../data/processed/reference_data/county_fips_mappings.csv"
bls_data_path_out <- "../../county-data/counties/"
data_bls <-
tibble(
fips_code = NA_character_,
period = NA_character_,
qtrly_estabs = NA_real_,
avg_wkly_wage = NA_real_
)
data_fips_mappings <-
fips_mappings_path_in %>%
read_csv()
# Loop from 2014-01 to 2020-3
period_start <- yq("2019-04")
period_end <- yq("2020-03")
available_periods <-
quarter(
seq(period_start, period_end, by = "1 quarter"),
with_year = T
) %>%
as.character()
for (period in available_periods) {
yr <- str_sub(period, start = 0L, end = 4L)
qtr <- str_sub(period, start = 6L, end = 6L)
data_path <- paste0("http://www.bls.gov/cew/data/api/", yr, "/", qtr, "/industry/10.csv")
data_bls <-
data_path %>%
read_csv() %>%
transmute(
fips_code = area_fips,
period = str_c(year, "-", qtr),
qtrly_estabs,
avg_wkly_wage
) %>%
rbind(data_bls)
print(paste0(yr, "-", qtr))
}
data_fips_mappings %>%
left_join(data_bls, by = "fips_code") %>%
select(
fips_code,
area,
period,
qtrly_estabs,
avg_wkly_wage
)
for (fip in available_fips) {
data_bls %>%
filter(fips_code == fip) %>%
write_csv(str_c(bls_data_path_out, fip, "/bls_data_", fip, ".csv"))
}
data_fips_mappings %>%
left_join(data_bls, by = "fips_code") %>%
select(
fips_code,
area,
period,
qtrly_estabs,
avg_wkly_wage
) %>%
arrange(period)
data_fips_mappings %>%
left_join(data_bls, by = "fips_code") %>%
select(
fips_code,
area,
period,
qtrly_estabs,
avg_wkly_wage
) %>%
arrange(fips_code, period)
for (fip in available_fips) {
data_bls %>%
filter(fips_code == fip) %>%
write_csv(str_c(bls_data_path_out, fip, "/bls_data_", fip, ".csv"))
}
